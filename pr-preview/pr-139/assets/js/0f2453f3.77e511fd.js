"use strict";(self.webpackChunkrts_docs_dev=self.webpackChunkrts_docs_dev||[]).push([["9355"],{63654:function(e,t,s){s.r(t),s.d(t,{frontMatter:()=>n,default:()=>h,toc:()=>l,metadata:()=>i,assets:()=>c,contentTitle:()=>a});var i=JSON.parse('{"id":"hpc/tutorial_intro_hpc/using_resources_effectively","title":"Using resources effectively","description":"Questions","source":"@site/docs/hpc/13_tutorial_intro_hpc/09_using_resources_effectively.mdx","sourceDirName":"hpc/13_tutorial_intro_hpc","slug":"/hpc/tutorial_intro_hpc/using_resources_effectively","permalink":"/rts-docs-dev/pr-preview/pr-139/docs/hpc/tutorial_intro_hpc/using_resources_effectively","draft":false,"unlisted":false,"editUrl":"https://github.com/NYU-ITS/rts-docs-dev/blob/main/docs/hpc/13_tutorial_intro_hpc/09_using_resources_effectively.mdx","tags":[],"version":"current","sidebarPosition":9,"frontMatter":{},"sidebar":"hpcSidebar","previous":{"title":"Running a parallel job","permalink":"/rts-docs-dev/pr-preview/pr-139/docs/hpc/tutorial_intro_hpc/running_parallel_job"},"next":{"title":"Using shared resources responsibly","permalink":"/rts-docs-dev/pr-preview/pr-139/docs/hpc/tutorial_intro_hpc/using_resources_responsibly"}}'),o=s(74132),r=s(89447);let n={},a="Using resources effectively",c={},l=[{value:"Estimating Required Resources Using the Scheduler",id:"estimating-required-resources-using-the-scheduler",level:2},{value:"Stats",id:"stats",level:2},{value:"Improving Resource Requests",id:"improving-resource-requests",level:2}];function u(e){let t={admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...e.components},{Details:s}=t;return s||function(e,t){throw Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"using-resources-effectively",children:"Using resources effectively"})}),"\n",(0,o.jsxs)(t.admonition,{title:"Overview",type:"info",children:[(0,o.jsx)(t.p,{children:"Questions"}),(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"How can I review past jobs?"}),"\n",(0,o.jsx)(t.li,{children:"How can I use this knowledge to create a more accurate submission script?"}),"\n"]}),(0,o.jsx)(t.p,{children:"Objectives"}),(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"Look up job statistics."}),"\n",(0,o.jsx)(t.li,{children:"Make more accurate resource requests in job scripts based on data describing past performance."}),"\n"]})]}),"\n",(0,o.jsx)(t.p,{children:"We\u2019ve touched on all the skills you need to interact with an HPC cluster: logging in over SSH, loading software modules, submitting parallel jobs, and finding the output. Let\u2019s learn about estimating resource usage and why it might matter."}),"\n",(0,o.jsx)(t.h2,{id:"estimating-required-resources-using-the-scheduler",children:"Estimating Required Resources Using the Scheduler"}),"\n",(0,o.jsx)(t.p,{children:"Although we covered requesting resources from the scheduler earlier with the Amdahl Program, how do we know what type of resources the software will need in the first place, and its demand for each? In general, unless the software documentation or user testimonials provide some idea, we won\u2019t know how much memory or compute time a program will need."}),"\n",(0,o.jsx)(t.admonition,{title:"Read the Documentation",type:"tip",children:(0,o.jsx)(t.p,{children:"Most HPC facilities maintain documentation as a wiki, a website, or a document sent along when you register for an account. Take a look at these resources, and search for the software you plan to use: somebody might have written up guidance for getting the most out of it."})}),"\n",(0,o.jsxs)(t.p,{children:["A convenient way of figuring out the resources required for a job to run successfully is to submit a test job, and then ask the scheduler about its impact using ",(0,o.jsx)(t.code,{children:"sacct -u $USER"}),". You can use this knowledge to set up the next job with a closer estimate of its load on the system. A good general rule is to ask the scheduler for 20% to 30% more time and memory than you expect the job to need. This ensures that minor fluctuations in run time or memory use will not result in your job being cancelled by the scheduler. Keep in mind that if you ask for too much, your job may not run even though enough resources are available, because the scheduler will be waiting for other people\u2019s jobs to finish and free up the resources needed to match what you asked for."]}),"\n",(0,o.jsx)(t.h2,{id:"stats",children:"Stats"}),"\n",(0,o.jsxs)(t.p,{children:["Since we already submitted amdahl to run on the cluster, we can query the scheduler to see how long our job took and what resources were used. We will use ",(0,o.jsx)(t.code,{children:"sacct -u $USER"})," to get statistics about ",(0,o.jsx)(t.code,{children:"parallel-job.sh"}),"."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"[NYUNetID@log-1 ~]$ sacct -u $USER\n       JobID    JobName  Partition    Account  AllocCPUS      State ExitCode\n------------ ---------- ---------- ---------- ---------- ---------- --------\n991167         Sxxxx     normal    nn9299k        128    COMPLETED      0:0\n"})}),"\n",(0,o.jsx)(t.p,{children:"This shows all the jobs we ran today (note that there are multiple entries per job). To get info about a specific job (for example, 347087), we change command slightly."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"[NYUNetID@log-1 ~]$ sacct -u $USER -l -j 347087\n"})}),"\n",(0,o.jsxs)(t.p,{children:["It will show a lot of info; in fact, every single piece of info collected on your job by the scheduler will show up here. It may be useful to redirect this information to ",(0,o.jsx)(t.code,{children:"less"})," to make it easier to view (use the left and right arrow keys to scroll through fields)."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"[NYUNetID@log-1 ~]$ sacct -u $USER -l -j 347087 | less -S\n"})}),"\n",(0,o.jsxs)(t.admonition,{title:"Discussion",type:"tip",children:[(0,o.jsx)(t.p,{children:"This view can help compare the amount of time requested and actually used, duration of residence in the queue before launching, and memory footprint on the compute node(s)."}),(0,o.jsx)(t.p,{children:"How accurate were our estimates?"})]}),"\n",(0,o.jsx)(t.h2,{id:"improving-resource-requests",children:"Improving Resource Requests"}),"\n",(0,o.jsxs)(t.p,{children:["From the job history, we see that ",(0,o.jsx)(t.code,{children:"amdahl"})," jobs finished executing in at most a few minutes, once dispatched. The time estimate we provided in the job script was far too long! This makes it harder for the queuing system to accurately estimate when resources will become free for other jobs. Practically, this means that the queuing system waits to dispatch our amdahl job until the full requested time slot opens, instead of \u201Csneaking it in\u201D a much shorter window where the job could actually finish. Specifying the expected runtime in the submission script more accurately will help alleviate cluster congestion and may get your job dispatched earlier."]}),"\n",(0,o.jsxs)(s,{children:[(0,o.jsx)("summary",{children:(0,o.jsxs)(t.admonition,{title:"Narrow the Time Estimate",type:"info",children:[(0,o.jsxs)(t.p,{children:["Edit ",(0,o.jsx)(t.code,{children:"parallel_job.sh"})," to set a better time estimate. How close can you get?"]}),(0,o.jsxs)(t.p,{children:["Hint: use ",(0,o.jsx)(t.code,{children:"-t"}),". ",(0,o.jsx)("br",{}),"\n",(0,o.jsx)(t.strong,{children:"[Click for Solution]"})]})]})}),(0,o.jsxs)(t.admonition,{title:"Solution",type:"tip",children:[(0,o.jsx)(t.p,{children:"The following line tells Slurm that our job should finish within 2 minutes:"}),(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"#SBATCH -t 00:02:00\n"})})]})]}),"\n",(0,o.jsx)(t.admonition,{title:"Key Points",type:"tip",children:(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"Accurate job scripts help the queuing system efficiently allocate shared resources."}),"\n"]})})]})}function h(e={}){let{wrapper:t}={...(0,r.a)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(u,{...e})}):u(e)}},89447:function(e,t,s){s.d(t,{Z:()=>a,a:()=>n});var i=s(39546);let o={},r=i.createContext(o);function n(e){let t=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:n(e.components),i.createElement(r.Provider,{value:t},e.children)}}}]);